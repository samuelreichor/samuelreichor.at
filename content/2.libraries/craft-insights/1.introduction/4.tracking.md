---
title: 'Tracking'
description: 'Understand how Insights tracks visitors while maintaining GDPR compliance.'
---

## How Tracking Works

Insights uses a lightweight JavaScript tracker that sends events to your Craft backend. All data is processed and stored in aggregated form-no raw event logs or personal data are retained.

## Automatic Tracking

Once you add the tracking script, the following events are tracked automatically:

### Pageviews

Tracked when the page loads. Captures:

- URL path (query parameters stripped)
- Screen size category (small/medium/large)
- Referrer domain (if external)
- Browser and device information (from User-Agent)
- UTM parameters (if present) :badge{label="Pro"}

### Engagement

Tracked when a user interacts with the page:

- **Scroll engagement** - User scrolls past 25% of the page
- **Click engagement** - User clicks anywhere on the page

Engagement events affect bounce rate calculation. A visitor who engages is not counted as a bounce.

### Leave Events

Tracked when the user leaves the page (via `visibilitychange`, `pagehide`, or `beforeunload`). Captures:

- Time spent on page (in seconds)

### Pro Event Types :badge{label="Pro"}

Additional event types available in the Pro edition:

- **Custom Events** - Track button clicks, form submissions, downloads via `trackEvent()`
- **Outbound Links** - Automatically track clicks on external links
- **Site Search** - Track search queries via `trackSearch()`

See [User Events](/libraries/craft-insights/usage/user-events), [Outbound Tracking](/libraries/craft-insights/usage/outbound-tracking), and [Search Tracking](/libraries/craft-insights/usage/search-tracking) for details.

## Visitor Identification

Insights uses a daily-rotating visitor hash to count unique visitors without fingerprinting. This is the same approach used by [Plausible](https://plausible.io/data-policy) and [Fathom](https://usefathom.com/blog/anonymization):

```
hash = SHA256(dailySalt + domain + ipAddress + userAgent)
```

The IP address is used **only** for generating this hash and is **immediately discarded**. It is never stored.

Key properties:

- **Changes daily** - Same visitor gets a new hash tomorrow
- **No persistence** - Nothing stored in cookies or localStorage
- **Non-reversible** - SHA256 hash cannot be reversed to recover IP
- **Domain isolation** - Same user on different sites = different hash
- **GDPR compliant** - IP used transiently, never stored

## Filtering

Certain requests are automatically excluded from tracking:

### Bot Detection

Requests are filtered if the User-Agent contains known bot signatures:

- `bot`, `crawl`, `spider`, `slurp`
- `lighthouse`, `pagespeed`, `gtmetrix`, `pingdom`, `uptimerobot`
- `headless`, `phantom`, `selenium`, `puppeteer`
- `wget`, `curl`

### Do Not Track

If `respectDoNotTrack` is enabled (default), requests with the `DNT: 1` header are skipped.

### Excluded Paths

Requests to paths in `excludedPaths` are ignored:

```php
'excludedPaths' => ['/admin', '/cpresources', '/actions']
```

### Excluded IPs :badge{label="Pro"}

Requests from IPs in `excludedIpRanges` are ignored.

### Logged-in Users

If `excludeLoggedInUsers` is enabled, authenticated Craft users are not tracked.

## Data Aggregation

Instead of storing individual events, Insights aggregates data in real-time:

```
Pageview event â†’ UPDATE pageviews SET views = views + 1
                                      WHERE url = '/about' AND date = '2024-01-15'
```

This approach:

- Minimizes storage requirements
- Ensures GDPR compliance (no raw event data)
- Provides fast query performance

## Queue Processing

By default, tracking events are processed asynchronously via Craft's queue system. This ensures:

- Minimal impact on page load time
- Reliable event processing
- Graceful handling of traffic spikes

Disable queue processing by setting `useQueue` to `false` (events will be processed synchronously).

