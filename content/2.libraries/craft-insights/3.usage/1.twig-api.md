---
title: 'Twig API'
description: 'Use Twig functions to add tracking and display analytics in your templates.'
---

## Tracking Functions

### `trackingScript()`

Registers the tracking script via Craft's asset bundle system.

```twig
{{ craft.insights.trackingScript() }}
```

::alert{variant=note}
  Technically it's not important where you add the script on your page as it always injects the script at the end of the body.
::

### `trackingScriptInline()`

Outputs the tracking script as inline JavaScript.

```twig
{{ craft.insights.trackingScriptInline()|raw }}
```

Use this when asset bundles aren't available (e.g., in certain caching scenarios).

## Statistics Functions

If you feel funky and want to use data captured by Insights, you can use these functions.

### `getSummary()`

Get summary statistics for a site.

```twig
{% set stats = craft.insights.getSummary('30d') %}

Pageviews: {{ stats.pageviews }}
Unique Visitors: {{ stats.uniqueVisitors }}
Bounce Rate: {{ stats.bounceRate }}%
Avg. Time: {{ stats.avgTimeOnPage }}s
```

**Parameters:**

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `range` | `string` | `'30d'` | Date range: `today`, `7d`, `30d`, `90d`, `12m` |
| `siteId` | `int\|null` | Current site | Specific site ID |

**Returns:**

```php
[
    'pageviews' => 12500,
    'uniqueVisitors' => 3200,
    'bounceRate' => 45.2,
    'avgTimeOnPage' => 127,
    'pageviewsTrend' => 12.5,   // % change from previous period
    'visitorsTrend' => 8.3,
]
```

### `getEntryStats()`

Get statistics for a specific entry.

```twig
{% set stats = craft.insights.getEntryStats(entry.id, '30d') %}

This page has {{ stats.views }} views and {{ stats.uniqueVisitors }} unique visitors.
```

**Parameters:**

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `entryId` | `int` | Required | The entry ID |
| `range` | `string` | `'30d'` | Date range |

**Returns:**

```php
[
    'views' => 450,
    'uniqueVisitors' => 280,
    'avgTime' => 95,
    'bounceRate' => 38.5,
]
```

### `getRealtimeCount()`

Get the current number of active visitors.

```twig
{{ craft.insights.getRealtimeCount() }} visitors online
```

**Parameters:**

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `siteId` | `int\|null` | Current site | Specific site ID |

### `getTopEvents()` :badge{label="Pro"}

Get top user events.

```twig
{% set events = craft.insights.getTopEvents('30d', 5) %}

{% for event in events %}
    {{ event.eventName }}: {{ event.count }} triggers
{% endfor %}
```

**Parameters:**

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `range` | `string` | `'30d'` | Date range |
| `limit` | `int` | `10` | Maximum results |
| `siteId` | `int\|null` | Current site | Specific site ID |

**Returns:**

```php
[
    [
        'eventName' => 'newsletter_signup',
        'eventCategory' => 'conversion',
        'count' => 145,
        'uniqueVisitors' => 142,
    ],
    // ...
]
```

## Utility Functions

### `isEnabled()`

Check if tracking is enabled.

```twig
{% if craft.insights.isEnabled() %}
    {# Tracking is active #}
{% endif %}
```

### `getCountryName()`

Convert ISO country code to full name.

```twig
{{ craft.insights.getCountryName('DE') }}
{# Output: Germany #}
```

### `getCountryFlag()`

Get flag emoji for a country code.

```twig
{{ craft.insights.getCountryFlag('DE') }}
{# Output: ðŸ‡©ðŸ‡ª #}
```

### `getStorageStats()`

Get database storage statistics.

```twig
{% set storage = craft.insights.getStorageStats() %}

Total records: {{ storage.pageviews + storage.referrers + storage.campaigns }}
Date range: {{ storage.oldestDate }} to {{ storage.newestDate }}
```

### `getGeoIpDatabaseInfo()` :badge{label="Pro"}

Get information about the GeoIP database.

```twig
{% set geoip = craft.insights.getGeoIpDatabaseInfo() %}

{% if geoip.exists %}
    GeoIP database: {{ geoip.size|number_format }} bytes
    Last updated: {{ geoip.modified }}
{% else %}
    GeoIP database not installed
{% endif %}
```

## Example: Analytics Widget

Display a simple analytics widget on your site:

```twig
{% set stats = craft.insights.getSummary('7d') %}

<div class="analytics-widget">
    <h3>This Week</h3>
    <dl>
        <dt>Visitors</dt>
        <dd>{{ stats.uniqueVisitors|number_format }}</dd>

        <dt>Pageviews</dt>
        <dd>{{ stats.pageviews|number_format }}</dd>

        <dt>Bounce Rate</dt>
        <dd>{{ stats.bounceRate }}%</dd>
    </dl>

    {% if stats.visitorsTrend > 0 %}
        <p class="trend positive">â†‘ {{ stats.visitorsTrend }}% vs last week</p>
    {% else %}
        <p class="trend negative">â†“ {{ stats.visitorsTrend|abs }}% vs last week</p>
    {% endif %}
</div>
```

