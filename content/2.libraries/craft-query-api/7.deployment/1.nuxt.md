---
title: 'Nuxt'
description: 'Learn how you can add your own transformers for custom fields.'
---

Here are a few ways to deploy your headless project. 
These guides are based on the [Craft Nuxt Starter](https://github.com/samuelreichor/craft-nuxt-starter) example. 
If you have a different setup then these might not work for you. 
Feel free to raise a GitHub issue if you feel something is missing here.

## Coolify

Coolify is a docker based, open-source Paas. For me it is the go to choice for cheap hosting.

### Prepare Project

To get started, you can add these files to your project. `docker-compose.yaml` should be in the root of your project.

::code-tree{defaultValue="docker-compose.yaml"}


```nginx [.coolify/nginx/craftcms/general.conf]
# favicon.ico
location = /favicon.ico {
    log_not_found off;
    access_log    off;
}

# robots.txt
location = /robots.txt {
    log_not_found off;
    access_log    off;
}

# assets, media
location ~* \.(?:css(\.map)?|js(\.map)?|jpe?g|png|gif|ico|cur|heic|webp|tiff?|mp3|m4a|aac|ogg|midi?|wav|mp4|mov|webm|mpe?g|avi|ogv|flv|wmv|txt)$ {
    expires    7d;
    access_log off;
}

# svg, fonts
location ~* \.(?:svgz?|ttf|ttc|otf|eot|woff2?)$ {
    add_header Access-Control-Allow-Origin "*";
    expires    7d;
    access_log off;
}

# gzip
gzip              on;
gzip_vary         on;
gzip_proxied      any;
gzip_comp_level   6;
gzip_types        text/plain text/css text/xml application/json application/javascript application/rss+xml application/atom+xml image/svg+xml;
```

```nginx [.coolify/nginx/craftcms/php_fastcgi.conf]
# 404
try_files                     $fastcgi_script_name =404;

# default fastcgi_params
include                       fastcgi_params;

# fastcgi settings
fastcgi_pass                  127.0.0.1:9000;
fastcgi_index                 index.php;
fastcgi_buffers               8 16k;
fastcgi_buffer_size           32k;

# fastcgi params
fastcgi_param DOCUMENT_ROOT   $realpath_root;
fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
```

```nginx [.coolify/nginx/craftcms/security.conf]
# security headers
add_header X-Frame-Options         "SAMEORIGIN" always;
add_header X-XSS-Protection        "1; mode=block" always;
add_header X-Content-Type-Options  "nosniff" always;
add_header Referrer-Policy         "no-referrer-when-downgrade" always;
#add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;

# . files
location ~ /\.(?!well-known) {
    deny all;
}
```

```nginx [.coolify/nginx/sites-available/default.conf]
server {
    listen      80 default_server;
    listen      [::]:80 default_server;
    set         $base /app;
    root        $base/web;
    # security
    include     craftcms/security.conf;

    # index
    index index.html index.htm index.php;

    # Craft CMS Stuff
    location ~ .*/api/.* {
        root /app/web;
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ .*/actions/.* {
        root /app/web;
        try_files $uri $uri/ /index.php?$query_string;
    }

    location /admin {
        root /app/web;
        try_files $uri $uri/ /index.php?$query_string;
    }

    location /gql {
        root /app/web;
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ ^/(sitemap.*|robots\.txt|security\.txt) {
        root /app/web;
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ^~ /assets/ {
        root /app/web;
        try_files $uri $uri/ @craft;
    }

    location ^~ /cpresources/ {
        root /app/web;
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ^~ /static/ {
        root /app/web;
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ^~ /uploads/ {
        root /app/web;
        try_files $uri $uri/ /index.php?$query_string;
    }

    # Nuxt Stuff
    location / {
        root /app/frontend/.output/public;
        index index.html;
        try_files $uri $uri.html $uri/index.html @nuxt-proxy;
    }

    location @nuxt-proxy {
        proxy_pass http://frontend:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    location ^~ /_nuxt/ {
        root /app/frontend/.output/public;
        try_files $uri $uri.html $uri/index.html @nuxt-proxy;
    }

    # additional config
    include craftcms/general.conf;

    # handle .php
    location ~ \.php$ {
        include craftcms/php_fastcgi.conf;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        fastcgi_param PATH_INFO $fastcgi_path_info;
    }
}
```

```nginx [.coolify/nginx/nginx.conf]
pid                  /run/nginx.pid;
worker_processes     auto;
worker_rlimit_nofile 65535;
daemon               off;
error_log /dev/stdout;

events {
    multi_accept       on;
    worker_connections 65535;
}

http {
    charset              utf-8;
    sendfile             on;
    tcp_nopush           on;
    tcp_nodelay          on;
    server_tokens        off;
    log_not_found        off;
    types_hash_max_size  2048;
    client_max_body_size 25M;

    # MIME
    include              mime.types;
    default_type         application/octet-stream;

    # Logging

     # Define custom log format to include reponse times
    log_format main_timed '$remote_addr - $remote_user [$time_local] "$request" '
                          '$status $body_bytes_sent "$http_referer" '
                          '"$http_user_agent" "$http_x_forwarded_for" '
                          '$request_time $upstream_response_time $pipe $upstream_cache_status';
    access_log           /dev/stdout main_timed;

    # write to tmp for non-privileged user
    client_body_temp_path /tmp/client_temp;
    proxy_temp_path /tmp/proxy_temp_path;
    fastcgi_temp_path /tmp/fastcgi_temp;
    uwsgi_temp_path /tmp/uwsgi_temp;
    scgi_temp_path /tmp/scgi_temp;

    # Load configs
    include              /etc/nginx/conf.d/*.conf;
    include              /etc/nginx/sites-enabled/*;
}
```

```nginx [.coolify/nginx/nginx.ini]
[program:nginx]
command=/usr/sbin/nginx -c /etc/nginx/nginx.conf
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
startretries=0
autorestart=true
```

```dockerfile [.coolify/web/Dockerfile.dockerfile]
ARG php_version
FROM ghcr.io/craftcms/image:${php_version}

USER root

# copy the files from the host to the container that we need
RUN rm /etc/nginx/sites-enabled/default
COPY ./.coolify/nginx/nginx.conf /etc/nginx/nginx.conf
COPY ./.coolify/nginx/nginx.ini /etc/supervisord.d/nginx.ini
COPY ./.coolify/nginx/craftcms /etc/nginx/craftcms
RUN mkdir -p /etc/nginx/sites-enabled
COPY ./.coolify/nginx/sites-available/default.conf /etc/nginx/sites-enabled/default.conf

# set the sockets and pid files to be writable by the appuser
RUN mkdir -p /var/log/nginx && chown -R appuser:appgroup /var/log/nginx
RUN chown -R appuser:appgroup /var/lib/nginx && touch /run/nginx.pid && chown -R appuser:appgroup /run/nginx.pid

# Install Composer
COPY --from=composer:2 /usr/bin/composer /usr/bin/composer

# Install other packages
RUN apt-get update && apt-get install -y --no-install-recommends \
  unzip bash vim \
  default-mysql-client libmariadb3 \
  && rm -rf /var/lib/apt/lists/*

WORKDIR /app
USER appuser

COPY composer.json composer.lock ./
RUN composer install --no-interaction --no-dev --optimize-autoloader

COPY --chown=appuser:appgroup . .

EXPOSE 9000 8080 80
```

```dockerfile [.coolify/node/Dockerfile.dockerfile]
# ---------- Build Stage ----------
FROM node:22-alpine AS build
WORKDIR /app

COPY package.json package-lock.json ./
COPY frontend/package.json frontend/package.json

RUN npm ci --workspaces --include-workspace-root

COPY frontend/ ./
RUN npm run build

# ---------- Runtime Stage ----------
FROM node:22-alpine
WORKDIR /app

COPY --from=build /app/.output/ ./

EXPOSE 3000

CMD ["node", "/app/server/index.mjs"]
```

```yaml [docker-compose.yaml]
services:
  web:
    build:
      context: .
      dockerfile: ./.coolify/web/Dockerfile
      args:
        - php_version=8.3
    volumes:
      - assets_data:/app/web/assets
    depends_on:
      db:
        condition: service_healthy

  frontend:
    build:
      context: .
      dockerfile: ./.coolify/node/Dockerfile

  db:
    image: mysql:8.4
    environment:
      MYSQL_DATABASE: db
      MYSQL_USER: db
      MYSQL_PASSWORD: db
      MYSQL_ROOT_PASSWORD: db
    volumes:
      - db_data:/var/lib/mysql
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      interval: 1s
      timeout: 3s
      retries: 10

volumes:
  db_data:
  assets_data::
```

``` [web/README.md]
This file is not needed. It should just represent your craft entry point.
```

``` [frontend/README.md]
This file is not needed. It should just represent your nuxt frontend.

```
::


### Prepare Coolify

#### 1. Create a Project and Add aÂ Resource
- Log in to your Coolify dashboard.
- Then, create a new project.
- Next, you'll need to add a new resource. When you do that, choose "Public Repository" as your deployment method.

![Add new coolify resource](/images/bitmap/craft-coolify-0.png)

> **Important Note**: You *really* want to use Git-based resources here, *not* Docker. I know, it's confusing, and I messed this up the first time too. But trust me, Git-based is what you need for things like auto-deployments when you push to your repo, and those are super handy.

#### 2. Set Up the Repository Details
- Now, you'll have to give Coolify the URL of your repository on GitHub.
- For the Build Pack, make sure you select "Docker Compose."
- Coolify should then automatically detect the `docker-compose.yaml` file in your repo. Double-check that it does! If it looks good, hit "Continue."

![Set Up the Repository Details](/images/bitmap/craft-coolify-1.png)

#### 3. Configure the Web Container
- You'll need to assign a domain to your web container.
- And don't forget to tick that little checkbox in the screenshot! It's easy to miss.

![Configure the Web Container](/images/bitmap/craft-coolify-2.png)

#### 4. Add Environment Variables
- In the left sidebar of Coolify, find **Environment Variables**.
- Add the following variables (Pro tip: If you enable the developer view in Coolify, it'll make adding these a lot faster!):

```plaintext
CRAFT_APP_ID=CraftCMS--bc2c8733-c91a-46fe-87f3-b53b44d38c2e
CRAFT_DB_DATABASE=db
CRAFT_DB_DRIVER=mysql
CRAFT_DB_PASSWORD=db
CRAFT_DB_PORT=3306
CRAFT_DB_SCHEMA=public
CRAFT_DB_SERVER=db
CRAFT_DB_TABLE_PREFIX=
CRAFT_DB_USER=db
CRAFT_ENVIRONMENT=production
CRAFT_SECURITY_KEY=qxyV2FckKZEwr91pVthQNaATzkVE41Zd
FALLBACK_IMAGE=/static/images/placeholder.png
PLUGIN_IMAGERX=XXXXXXXXXXXXXXXXXXXXXXXX
PLUGIN_NAVIGATION=XXXXXXXXXXXXXXXXXXXXXXXX
PLUGIN_QUERY_API=XXXXXXXXXXXXXXXXXXXXXXXX
PLUGIN_SEOMATIC=XXXXXXXXXXXXXXXXXXXXXXXX
PRIMARY_SITE_URL=https://cheap-craft.steelcity-creative.at
PRIMARY_SITE_URL_DE=https://cheap-craft.steelcity-creative.at/de
PRIMARY_SITE_URL_ES=https://cheap-craft.steelcity-creative.at/es
NUXT_CRAFT_TOKEN=iIkWn1cMYA181On591yqdhJluAzI-r1c
NUXT_ENVIRONMENT=production
NUXT_PRIMARY_SITE_URL=https://cheap-craft.steelcity-creative.at
NUXT_PRIMARY_SITE_URL_DE=https://cheap-craft.steelcity-creative.at/de
NUXT_PRIMARY_SITE_URL_ES=https://cheap-craft.steelcity-creative.at/es
```

#### 5. Deploy!
You can finally deploy your application! Just click the "Deploy" button in the top right corner.
You should now see an error of Nuxt in the frontend (`/`) and an error of Craft in the backend (`/admin`).

#### 6. Import Database

Now you can import an existing database into the `db` container or use the `php craft setup` command in the `web` container to start fresh.

#### 7. Apply Changes after Deployment

- Go to the "General Configuration" and scroll down to "Pre/Post Deployment Commands."
- You can put commands here that you want to run automatically after a successful deployment. For me, it's usually something like`php craft up && php craft clear-caches/all`, but you can also put the path to a script if you need to do something more complicated.

![Apply Migrations and Config Changes](/images/bitmap/craft-coolify-4.png)
